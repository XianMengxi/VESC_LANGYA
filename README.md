# VESC_LANGYA

复刻自VESC6.4，无感FOC，去除了多余元件

将电流测量芯片改成了INA240，将测量电阻改成了4毫欧。

## 硬件设计参考

[VESC硬件](https://vesc-project.com/node/311)

## 硬件设计要点 VERSION-1 2024.8.29

1. 参考DRV8301手册，多个电容需要以最短路径回到芯片地。

2. 走线足够宽以保证散热，或者以大面积铺铜代替走线。

3. DRV8301自带5V DCDC稳压，可以加以利用。

4. MOS管周围多打孔保证散热。

5. 功率地和驱动芯片（以及MCU）地分离，通过单点连接，以保证系统的抗扰能力。

6. 要注意信号流向，信号出电容的电压必然是最纯净的，无论是MCU还是驱动芯片的供电都应该尽可能靠近电容走线。

7. 电流测量需要差分走线（开尔文接法，详情见INA240手册）

## 第一版存在的问题

1. 输入的两个大电容留下的焊接空间不足，导致有一个贴片电解电容焊接不上去。

2. USB封装买错了，导致USB接口虽然可以焊接，但难以固定，很容易在拔插过程中造成掉焊盘的情况。

3. 有一个贴片电解电容放在底层，导致凸起来一部分，十分不美观。

4. 其它问题挖坑待测试。

## 测试

1. 参考[官方源码](https://github.com/vedderb/bldc/)，需要修改到RELEASE_6_05分支(需要与VESC Tool适配)，修改测量电阻大小以适配硬件。

2. 在Ubuntu环境下使用make arm_sdk_install 可以配置编译环境，详情可见源代码 README.md。

3. make 60 指令进行编译。

4. 将生成的.bin文件使用ST-link烧录到板子上。

5. 使用VESC 6.05版本（必须，以适配代码），根据[官方手册](https://vesc-project.com/node/938)既可以完成电机FOC控制的初步测试。

6. 测试结果见test文件夹（使用DJI Snail电机进行测试）